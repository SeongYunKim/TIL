# 서버 설정

- MySQL 서버는 ```my.cnf```라는 이름의 설정 파일을 ```기동 될 때 만``` 참고

## MySQL 시스템 변수

- 기동하면서 설정 파일의 내용을 읽어 작동 방식을 초기화, ```시스템 변수```에 저장

### Var Scope (Global, Session)

- Global: ```MySQL 서버 인스턴스```에 전체적으로 영향을 미치는 시스템 변수 (ex. query_cache_size, innodb_buffer_pool_size, key_buffer_size)

- Session: ```MySQL 클라이언트가 MySQL 서버에 접속할 때``` 기본적으로 부여하는 옵션의 시스템 변수 (ex. AutoCommit)

- Both: Session 시스템 변수 중 서버 설정 파일에 명시해 초기화 할 수 있는 시스템 변수

### Dynamic

- Dynamic: 서버가 ```기동 중인 상태에서 변경 가능```한 시스템 변수

(```SET``` 명령어, 서버 설정 파일에 반영되는 것은 아니므로 현재 기동중인 인스턴스에서만 유효)

- Static: ```서버 설정 파일을 바꾸고 재기동``` 시 반영되는 시스템 변수

## my.cnf 설정 파일

- 모든 종류의 서비스에 적합한 설정 파일은 있을 수 없으며 각자의 시스템에 맞게 변경 필요

- 기본값은 절대 그대로 사용하면 안된다? **NO**

    - 가장 일반적인 환경에서 최적으로 작동하는 값을 최고의 전문가가 설정해 둔 것

### 다양한 설정 종류

- basedir, datadir, tmpdir

    - basedir: MySQL 서버 홈 디렉토리

    - datadir: MyISAM의 ```데이터 파일```이 저장되는 디렉토리 (InnoDB는 별도의 파라미터로 경로 지정)

    - tmpdir: 정렬, 그룹핑 등을 위해 ```내부적으로 생성하는 임시 테이블 데이터 파일```이 저장되는 디렉토리

- default-storage-engine

    - ```기본적으로 사용할 스토리지 엔진``` 정의

    - 사용자가 테이블 생성 시 스토리지 엔진을 정의하지 않을 때 사용

- max_connection

    - 서버가 ```최대```한 허용할 수 있는 ```클라이언트 연결 수``` (동적 변경 가능)

    - 무작정 크다면? 무거운 일부 쿼리가 ```자원을 다 사용```해도 계속해서 ```커넥션 생성``` => ```응답 불능``` 상태 유발

    - 최근에는 [커넥션 풀](https://en.wikipedia.org/wiki/Connection_pool, '커넥션 풀') 방식을 많이 사용, 적절한 커넥션 개수 설정 필요

- thread_cache_size

    - 스레드: 커넥션의 작업 요청을 처리하는 주체

    - 스레드를 생성하는 데 CPU 처리가 필요하므로, ```커넥션 종료되어도 제거하지 않고 스레드 풀```에 저장

    - 새로운 접속 요청 시 해당 커넥션에 스레드 풀 할당

    - 최대 ```몇 개의 스레드를 스레드 풀에``` 보관할 것인가?

    - ```커넥션 풀 방식```을 사용할 경우, ```대량의 커넥션 요청이 발생하지 않으므로``` 크게 유지할 필요 없음

- wait_timeout

    - 클라이언트가 ```wait_timeout 시간 동안 아무런 요청 없이 대기```하는 경우 ```커넥션 강제 종료```

    - 커넥션이 예상보다 짧은 시간에 종료되는 경우? 운영 체제 idle-timeout, keep-alive 설정 등 확인 필요

- max_allowed_packet

    - 클라이언트의 ```최대 요청 패킷 크기```

    - 쿼리 요청은 항상 패킷 한 개, 실행 결과는 여러개의 패킷으로 분할

- sort_buffer_size

    - ```인덱스가 아닌 칼럼```으로 정렬 시 얼마나 ```메모리 공간```을 할당할 것인가

    - 클 수록 정렬이 빠르다? **NO** => 64KB ~ 512KB가 적당

    - ```세션 시스템 변수```, 커넥션 별로 메모리 공간 할당 => 불필요하게 크게 설정하지 않도록!

- transaction-isolation

    - 트랙잭션의 격리 수준

    - REPEATABLE-READ(default), UNCOMMITTED, READ-COMMITTED, SERIALIZABLE

    - ~~자세한 내용은 따로 정리해도 좋을 듯~~

- innodb_buffer_pool_size

    - InnoDB 버퍼 풀: 디스크의 데이터를 ```메모리에 캐싱```, ```데이터 변경을 버퍼```

    - 운영 체제, MySQL 커넥션 스레드 메모리 제외하고 남는 거의 모든 메모리 공간 (50~80%)

    - ```정적 변수```이므로 변경 적용을 위해 서버 재시작 필요

- innodb_log_group_home_dir

    - Redo 로그를 저장 디렉토리

    - ```Redo 로그(트랜잭션 로그)```: ACID 보장, 성능 향상을 목적으로 ```데이터 변경 이력``` 기록

    - MySqL 서버가 갑자기 종료되거나 트랜잭션 오류를 복구하기 위한 용도로 사용

- innodb_log_buffer_size

    - 데이터 변경 사항을 바로 Redo 로그에 기록하면 ```디스크 입출력이 빈번```

    - 로그 버퍼링을 위한 최대 메모리 공간

- key_buffer_size

    - MyISAM 스토리지 엔진에서 (주로) ```인덱스 캐시``` 역할로 사용하는 최대 버퍼 공간

- general_log_file

    - 모든 쿼리 로그 파일

    - 서버에서 많은 쿼리를 수행한다면 로그 ```기록에 컴퓨팅 자원을 다 사용```할 수 있개 때문에 ```사용하지 않는 것```이 좋음

- slow_query_log_file

    - 지정된 시간 이상 실행된(튜닝이 필요한) 쿼리 로그 파일

- log-bin

    - 복제 시 사용되는 바이너리 로그 파일

    - 복제: 슬레이브 MySQL 서버가 ```마스터 MySQL 서버의 바이너리 로그를 재실행```

- sync_binlog

    - ```바이너리 로그 동기화 시 디스크 쓰기 부하```가 큼

    - 1로 설정 시, ```트랜잭션이 커밋``` 될 때 마다 바이너리 로그를 디스크에 동기화 => ```바이너리 로그 손실 감소, MySQL 서버 성능 저하```

    - 0으로 설정 시, MySQL 서버에 동기화 X => ```서버 성능 향상, 바이너리 로그 손실 증가```(장애 발생 시 마스터, 슬레이브 데이터 달라질 가능성 증가)

- read_only

    - 읽기 전용 슬레이브 MySQL 서버 데이터가 변경되지 않도록

## 느낀 점

책에서 소개된 50개가 넘는 설정 중 10여가지만 정리를 해보았다. 물론 앞으로 개발을 하며 평생 기본값으로 사용할 설정들도 있을 것이다. 하지만 다양한 설정들을 알아보며, 개발자가 데이터베이서의 어떤 부분까지
통제할 수 있는지 알게 되었다. 또한, 각 설정들의 작동을 알아보며 커넥션, 쿼리, 복제 등이 대략 어떤 방식으로 데이터베이스에서 관리되는지 느낌을 갖게 되었다. 구체적인 작동 및 관리 방식에 대해서는 하나씩 공부할
것이다.

### 참고

- Real MySQL 02장 (설치와 설정)
